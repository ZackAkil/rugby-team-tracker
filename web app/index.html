<html lang="en">

<head>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@700&family=Open+Sans&display=swap"
        rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>

    <link href="styles.css" rel="stylesheet">

    <style>
        #video-container {
            margin: 30px 0;
            position: relative;
        }

        #current-event, #score {
            z-index: 1;
            padding: 5px 0 0 5px;
            width: 100%;
            position: absolute;
        }

        #score>div{
            width: fit-content;
            background-color: rgb(255, 255, 255);
            padding: 10px 14px;
        }

        #current-event>div {
            width: fit-content;
            background-color: rgb(255, 255, 255);
            margin: 0 auto;
            padding: 10px 14px;
        }

        #current-event>div>h3 {
            margin-right: 10px;
        }


        #current-event>div>a {
            margin-left: 5px;
        }
    </style>
</head>


<body>

    <div id="app">

        <header>
            <h1>FiftyTen</h1>
        </header>

        <match-details v-bind:home_team="home_team" v-bind:away_team="away_team" v-bind:match_details="match_details">
        </match-details>

        <div id="video-container">

            <div id="score">
                <div>
                    <span>{{current_score[0]}}</span> : <span>{{current_score[1]}}</span>
                </div>
            </div>

            <div id="current-event" v-if="current_event">
                <div>
                    <h3 class="scorer team-text"
                        v-bind:style="{ 'text-decoration-color': current_event.team == 'home' ? home_team.color : away_team.color }">
                        {{current_event.scorer}} </h3>

                    <span> {{ parseInt(current_event.exact_time/60)}}' {{ current_event.distance}}m
                        +{{current_event.points}}</span>

                    <a href="#">Download clip</a>
                </div>
            </div>

            <video controls src="rugby_test.mp4" ontimeupdate="video_time_change()"></video>

        </div>


        <match-timeline v-bind:match_events="match_events" v-bind:home_team_color="home_team.color"
            v-bind:away_team_color="away_team.color">
        </match-timeline>


    </div>


    <script src="components/match-timeline.js"></script>
    <script src="components/match-details.js"></script>
    <script>
        function jump_video_to_time(time) {
            // move video to time in seconds
            const video = document.querySelector('video')
            video.currentTime = time
            video.play()
        }

        function video_time_change() {
            const video = document.querySelector('video')
            app.current_event = get_current_event(video.currentTime, match_events)
            calculate_current_score(video.currentTime, match_events)
        }

        function get_current_event(time, events){
            var output = null
            for (let index = 0; index < events.length; index++) {
                const element = events[index]
                if ((element.time_from <= time) && (element.time_to >= time)){
                    return events[index]
                }
            }
            return output
        }

        function calculate_current_score(time, events){

            var current_score = [0,0]

            for (let index = 0; index < events.length; index++) {
                const element = events[index]
                if (element.exact_time <= time){
                    if (element.team == 'home')
                        current_score[0] += element.points
                    else
                        current_score[1] += element.points
                }
            }

            app.current_score = current_score
        }

        const match_events = [
            { 'team': 'home', 'scorer': 'Zack.A', 'points': 1, 'assist': 'Joe', 'time_from': 40, 'exact_time': 45, 'time_to': 50, 'distance': 33 },
            { 'team': 'away', 'scorer': 'Someone', 'points': 2, 'time_from': 120, 'exact_time': 130, 'time_to': 140, 'distance': 5 },
            { 'team': 'home', 'scorer': 'Alex', 'points': 2, 'assist': 'Mary', 'time_from': 150, 'exact_time': 160, 'time_to': 180, 'distance': 60 }
        ]

        var app = new Vue({

            el: '#app',
            data: {
                current_score: [0,0],
                current_event: null,
                home_team: { 'name': "Lord of the (Girl) tries", 'color': '#28e3e6' },
                away_team: { 'name': "Panthers", 'color': 'orange' },
                match_events: match_events,
                match_details: { 'date': '9th April 2021', 'location': 'East London 3G' }
            }
        })

    </script>

</body>

</html>